# Ethereum Smart Contract for Earnest Money 

This project demonstrates how to use an Ethereum Smart Contract to manage earnest money agreements associated with real estate transactions.
When a property buyer enters into a real estate contract, the realtor typically requests a sum of money be deposited in _good faith_ (usually 1% of the sales price) to help convince the seller that the buyer is serious about the purchase. Currently, this process is accomplished by executing the following tasks:
1. The buyer writes a check to the realtor.
2. The realtor holds the check until the seller agrees to the terms of the real estate contract.
3. The realtor deposits the check into a bank account.
4. The realtor writes a check to the closing agent (i.e. an attorney) and brings it to closing.
5. The closing agent deposits the check into a bank account.

If, for some reason, the real estate contract becomes invalid, the realtor needs to refund the buyer's money either by returning the buyer's check or by issuing a new check to the buyer. This process is labor intensive and time consuming.

The manual movement of writing and depositing checks is replaced with an Ethereum smart contract implementing the following functions:
- **register** -  A realtor registers a new earnest money agreement. A stipend is paid to the contract owner as a usage fee. Ether is taken from the realtor's account and transferred to the contract owner's account.
- **deposit** - A property buyer deposits funds. Ether is taken from the buyer's account and transferred to the smart contract balance.
- **release** - A realtor releases funds to the closing agent. Ether is transferred from the contract balance to the closing agent's account.
- **refund** - A realtor returns funds to the buyer. Ether is transferred from the contract balance to the buyer's account.
- **cancel** - A realtor cancels an earnest money agreement after funds are either released or refunded.
- **status** - Allows a realtor or buyer to check the current status of an earnest money agreement.

Each earnest money agreement is identified by a unique string (UUID). This string identifies an earnest money agreement to the outside world. It is generated by the UI codebase (i.e. Java, Javascript) that actually interacts with the smart contract.

For an example, see the [Earnest Money Angular App](https://github.com/programming4phone/EarnestMoneyNgApp "Earnest Money Angular App").

## Development stack

This project was developed using Solidity v0.4.18, Truffle v4.0.4, and Ganache v1.0.1.

## Prerequisites

A text editor to edit `.sol` files. Visual Studio Code 1.19.2 used here.

## Build
From a command prompt opened to the source directory, run this command:

`truffle.cmd compile --all` 

## Tests
It is recommended to run the tests individually and to restart Ganache after each test.  This will avoid _Out of Gas_ conditions from occurring while running the tests.

From a command prompt opened to the source directory, run these commands:

`truffle.cmd test ./test/earnestmoneyRegister.js`

`truffle.cmd test ./test/earnestmoneyDeposit.js`

`truffle.cmd test ./test/earnestmoneyRelease.js`

`truffle.cmd test ./test/earnestmoneyRefund.js`

`truffle.cmd test ./test/earnestmoneyCancel.js`

`truffle.cmd test ./test/earnestmoneyStatus.js`

## Migrations
From a command prompt opened to the source directory, run this command to deploy to the default Ganache instance:

`truffle.cmd migrate --reset --network ganachedevelopment`

The network name is defined in `truffle.js`.

For testing purposes the contract owner address is hard coded in `2_deploy_contracts.js` using the value of the first test account supplied by Ganache. This is supplied to the contract constructor during deployment. In production, this address would need to be a real address on the Live Ethereum network.